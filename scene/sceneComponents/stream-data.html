<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Data Stream</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <script type="importmap">
            {
                "imports": {
                    "uplot": "https://unpkg.com/uplot/dist/uPlot.esm.js"
                                    }
              }
        </script>
        <link rel="stylesheet" href="https://unpkg.com/uplot@1.6.32/dist/uPlot.min.css">
    </head>
    <body>

        <script type="module">
            import uPlot from "uplot";
			import { makeChart } from "./DynamicChart.js";
      
			// Generate synthetic data instead of fetching external file
			function generateSampleData() {
				console.time('data-generation');
				
				const dataPoints = 50000;
				const timeStep = 60; // seconds
				const startTime = 1566453600; // arbitrary epoch time
				
				// Initialize data arrays for 4 series (time + 3 metrics)
				let data = [
					Array(dataPoints), // timestamps
					Array(dataPoints), // CPU - sine wave
					Array(dataPoints), // RAM - random walk
					Array(dataPoints)  // TCP Out - cosine with noise
				];
				
				// Random walk starting point
				let randomWalk = 50;
				
				// Generate data points
				for (let i = 0; i < dataPoints; i++) {
					// Time axis (seconds)
					data[0][i] = startTime + (i * timeStep);
					
					// CPU: Sine wave between 0-100%
					data[1][i] = 50 + 40 * Math.sin(i / 100);
					
					// RAM: Random walk between 0-100%
					randomWalk += (Math.random() - 0.5)*0.5;
					data[2][i]  = Math.min(Math.max(randomWalk, 10), 90); // Keep between 10-90%
					
					
					// TCP Out: Cosine with random noise (0-60 MB)
					data[3][i] = 30 + 25 * Math.cos(i / 50) + (Math.random() * 5);
				}
				
				return data;
			}
			
			
			let data = generateSampleData();
			makeChart(data,uPlot);
		</script>
	</body>
</html>